
<!DOCTYPE html>
<html lang="en" class="loading">
<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Android之定位 - Hexo</title>
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="google" content="notranslate" />
    <meta name="keywords" content="Fechin,"> 
    <meta name="description" content="追着光 成为光,百度地图定位
1.配置环境，添加权限
123456789&amp;lt;service    android:name=&amp;quot;com.baidu.location.f&amp;quot;    android,"> 
    <meta name="author" content="jagtasp"> 
    <link rel="alternative" href="atom.xml" title="Hexo" type="application/atom+xml"> 
    <link rel="icon" href="/img/favicon.png"> 
    
<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">

    
    
    <meta name="twitter:card" content="summary"/>
    <meta name="twitter:title" content="Android之定位 - Hexo"/>
    <meta name="twitter:description" content="追着光 成为光,百度地图定位
1.配置环境，添加权限
123456789&amp;lt;service    android:name=&amp;quot;com.baidu.location.f&amp;quot;    android,"/>
    
    
    
    
    <meta property="og:site_name" content="Hexo"/>
    <meta property="og:type" content="object"/>
    <meta property="og:title" content="Android之定位 - Hexo"/>
    <meta property="og:description" content="追着光 成为光,百度地图定位
1.配置环境，添加权限
123456789&amp;lt;service    android:name=&amp;quot;com.baidu.location.f&amp;quot;    android,"/>
    
<link rel="stylesheet" href="/css/diaspora.css">

<meta name="generator" content="Hexo 6.1.0"></head>

<body class="loading">
    <span id="config-title" style="display:none">Hexo</span>
    <div id="loader"></div>
    <div id="single">
    <div id="top" style="display: block;">
    <div class="bar" style="width: 0;"></div>
    <a class="iconfont icon-home image-icon" href="javascript:;" data-url="http://example.com"></a>
    <div title="播放/暂停" class="iconfont icon-play"></div>
    <h3 class="subtitle">Android之定位</h3>
    <div class="social">
        <div>
            <div class="share">
                <a title="获取二维码" class="iconfont icon-scan" href="javascript:;"></a>
            </div>
            <div id="qr"></div>
        </div>
    </div>
    <div class="scrollbar"></div>
</div>

    <div class="section">
        <div class="article">
    <div class='main'>
        <h1 class="title">Android之定位</h1>
        <div class="stuff">
            <span>十月 12, 2022</span>
            
  <ul class="post-tags-list" itemprop="keywords"><li class="post-tags-list-item"><a class="post-tags-list-link" href="/tags/Android/" rel="tag">Android</a></li></ul>


        </div>
        <div class="content markdown">
            <p>百度地图定位</p>
<p>1.配置环境，添加权限</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">service</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:name</span>=<span class="string">&quot;com.baidu.location.f&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:enabled</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:process</span>=<span class="string">&quot;:remote&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">intent-filter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">&quot;com.baidu.location.service_v5.0.0&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">service</span>&gt;</span></span><br><span class="line">//在<span class="tag">&lt;<span class="name">application</span>&gt;</span>节点里面添加</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">&quot;android.permission.FOREGROUND_SERVICE&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">&quot;android.permission.ACCESS_NETWORK_STATE&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">&quot;android.permission.INTERNET&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">&quot;com.android.launcher.permission.READ_SETTINGS&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">&quot;android.permission.WAKE_LOCK&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">&quot;android.permission.CHANGE_WIFI_STATE&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">&quot;android.permission.ACCESS_WIFI_STATE&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">&quot;android.permission.WRITE_EXTERNAL_STORAGE&quot;</span> /&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 这个权限用于进行网络定位--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">&quot;android.permission.ACCESS_COARSE_LOCATION&quot;</span>/&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 这个权限用于访问GPS定位--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">&quot;android.permission.ACCESS_FINE_LOCATION&quot;</span>/&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 获取运营商信息，用于支持提供运营商信息相关的接口--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">&quot;android.permission.ACCESS_NETWORK_STATE&quot;</span>/&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 用于读取手机当前的状态--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">&quot;android.permission.READ_PHONE_STATE&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p>2.定位SDK的使用步骤</p>
<p>①创建定位服务的客户端（LocationClient）</p>
<p>LocationClient必须在主线程中声明，需要Context类型的参数，推进使用getApplicationContext获取全进程有效的Context。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="type">LocationClient</span> <span class="variable">mLocationClient</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onCreate</span><span class="params">()</span> &#123;</span><br><span class="line">    mLocationClient </span><br><span class="line">        = <span class="keyword">new</span> <span class="title class_">LocationClient</span>(getApplicationContext());     </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/2022/10/12/Android%E4%B9%8B%E5%AE%9A%E4%BD%8D/a.png"></p>
<p>②对定位服务客户端进行设置（LocationClientOption）</p>
<p>配置定位SDK参数类，比如定位模式，定位时间间隔，坐标系类型等。</p>
<p>定位模式分为三种：</p>
<p>高精度定位模式：同时使用网络定位和GPS定位，优先返回最高精度的定位结果。</p>
<p>低功耗定位模式：不使用GPS，只是用 网络定位（WiFi和基站）。</p>
<p>仅用设备定位模式：不使用网络定位，只使用GPS进行定位。但是此模式下不支持室内环境的定位。</p>
<p><img src="/2022/10/12/Android%E4%B9%8B%E5%AE%9A%E4%BD%8D/b.png"></p>
<p>坐标类型：</p>
<p>国测局经纬度坐标系：”gcj02”</p>
<p>百度墨卡托坐标系：”bd09”</p>
<p>百度经纬度坐标系：”bd09ll”(是L不是1)</p>
<p>定位模式：</p>
<p>高精度定位模式：Hight_Accuracy</p>
<p>低功耗定位模式：Battery_Saving</p>
<p>仅用设备定位模式： Device_Sensors</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 设置定位的相关配置</span></span><br><span class="line"><span class="type">LocationClientOption</span> <span class="variable">option</span> </span><br><span class="line">        <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">LocationClientOption</span>();</span><br><span class="line">option.setOpenGps(<span class="literal">true</span>);       <span class="comment">// 打开GPS</span></span><br><span class="line">option.setCoorType(<span class="string">&quot;bd09ll&quot;</span>);  <span class="comment">// 坐标类型</span></span><br><span class="line">option.setScanSpan(<span class="number">1000</span>);      <span class="comment">// 扫描间隔</span></span><br><span class="line"><span class="comment">// 定位模式</span></span><br><span class="line">option.setLocationMode(LocationClientOption</span><br><span class="line">        .LocationMode.Hight_Accuracy); </span><br><span class="line"><span class="comment">// 通过配置参数对定位客户端进行设置</span></span><br><span class="line">mLocationClient.setLocOption(option);  </span><br></pre></td></tr></table></figure>

<p>③实现监听接口（BDAbstractLocationListener）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 定位服务客户端设置回调接口</span></span><br><span class="line">locationClient.registerLocationListener(locationListener);  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyLocationListener</span> <span class="keyword">extends</span> <span class="title class_">BDAbstractLocationListener</span>&#123;  </span><br><span class="line">    <span class="comment">// 异步返回的定位结果  </span></span><br><span class="line">    <span class="meta">@Override</span>  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onReceiveLocation</span><span class="params">(BDLocation location)</span> &#123; </span><br><span class="line">        <span class="comment">// 处理定位信息 </span></span><br><span class="line">    &#125;  </span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<p>可以回调的百度坐标类</p>
<p><img src="/2022/10/12/Android%E4%B9%8B%E5%AE%9A%E4%BD%8D/c.png"></p>
<p>定位的错误码也是通过BDLocation.getLocType()这个方法得到的</p>
<p><img src="/2022/10/12/Android%E4%B9%8B%E5%AE%9A%E4%BD%8D/d.png"></p>
<p>如果想要显示在地图上，就像百度地图那样出现一个点表示地图的定位点，就需要用到下面两个类：</p>
<p>MyLocationConfiguration(配置定位图层显示方式)</p>
<p>MylocationData(定位数据)</p>
<p>（1）MyLocationConfiguration：通过BaiduMap.setMyLocationConfigeration()方法设置定位图层信息。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="title function_">MyLocationConfiguration</span> </span><br><span class="line">           <span class="params">(MyLocationConfiguration.LocationMode mode, </span></span><br><span class="line"><span class="params">            <span class="type">boolean</span> enableDirection, </span></span><br><span class="line"><span class="params">            BitmapDescriptor customMarker)</span></span><br><span class="line">参数:</span><br><span class="line">mode - 定位图层显示方式, 默认为 LocationMode.NORMAL 普通态</span><br><span class="line">enableDirection - 是否允许显示方向信息</span><br><span class="line">customMarker - 设置用户自定义定位图标，可以为 <span class="literal">null</span></span><br></pre></td></tr></table></figure>

<p>定位图层显示方法：</p>
<p>MyLocationConfiguration.LocationMode.COMPASS</p>
<p>罗盘态，显示定位方向圈，保持定位图标在地图中心</p>
<p>MyLocationConfiguration.LocationMode.FOLLOWING</p>
<p>跟随态，保持定位图标在地图中心</p>
<p>MyLocationConfiguration.LocationMode.NORMAL</p>
<p>普通态： 更新定位数据时不对地图做任何操作</p>
<p>（2）MylocationData(定位数据)</p>
<p>MyLocationData包含一个内部类Builder用于构建对象。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 构造定位数据  </span></span><br><span class="line"><span class="type">MyLocationData</span> <span class="variable">locData</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyLocationData</span>.Builder()  </span><br><span class="line">                    .accuracy(radius)    <span class="comment">// 精度 </span></span><br><span class="line">                    .direction(direction)<span class="comment">// 方向  </span></span><br><span class="line">                    .latitude(latitude)  <span class="comment">// 纬度</span></span><br><span class="line">                    .longitude(longitude)<span class="comment">// 经度 </span></span><br><span class="line">                    .build();  <span class="comment">// 构建生成定位数据对象</span></span><br><span class="line"><span class="comment">// 通过BaiduMap.setMyLocationData()设置定位数据  </span></span><br><span class="line">bdMap.setMyLocationData(locData); </span><br></pre></td></tr></table></figure>

<p>通过调用定位的onReceiveLocation()方法可以得到定位的经纬度，然后可以通过animateMapStatus()方法把定位到的点移动到地图中心。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">LatLng</span> <span class="variable">ll</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">LatLng</span>(mCurrentLantitude,</span><br><span class="line">                       mCurrentLongitude);</span><br><span class="line"><span class="type">MapStatusUpdate</span> <span class="variable">u</span> </span><br><span class="line">        <span class="operator">=</span> MapStatusUpdateFactory.newLatLng(ll);</span><br><span class="line">mBaiduMap.animateMapStatus(u);</span><br></pre></td></tr></table></figure>

<p>④开启定位服务（locationClient.start()）</p>
<p>通过定位服务客户端的start()函数来开启定位服务，通过stop()函数来关闭定位服务。</p>
<p>因为定位也是比较耗电的，所以通常我们在Activity 的onStart中开启定位，在onStop中关闭定位，这样应用最小化时就不会一直进行GPS请求定位了。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onStart</span><span class="params">()</span> &#123;</span><br><span class="line">    mBaiduMap.setMyLocationEnabled(<span class="literal">true</span>);  <span class="comment">// 开启图层定位</span></span><br><span class="line">    <span class="keyword">if</span> (!mLocationClient.isStarted()) &#123;</span><br><span class="line">        mLocationClient.start();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">super</span>.onStart();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onStop</span><span class="params">()</span> &#123;</span><br><span class="line">    mBaiduMap.setMyLocationEnabled(<span class="literal">false</span>); <span class="comment">// 关闭图层定位</span></span><br><span class="line">    mLocationClient.stop();</span><br><span class="line">    <span class="built_in">super</span>.onStop();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


            <!--[if lt IE 9]><script>document.createElement('audio');</script><![endif]-->
            <audio id="audio" loop="1" preload="auto" controls="controls" data-autoplay="false">
                <source type="audio/mpeg" src="">
            </audio>
            
                <ul id="audio-list" style="display:none">
                    
                        
                            <li title="0" data-url="http://link.hhtjim.com/163/425570952.mp3"></li>
                        
                    
                        
                            <li title="1" data-url="http://link.hhtjim.com/163/425570952.mp3"></li>
                        
                    
                </ul>
            
        </div>
        
    <div id="gitalk-container" class="comment link"
		data-enable="true"
        data-ae="tryes"
        data-ci=""
        data-cs=""
        data-r=""
        data-o=""
        data-a=""
        data-d="false"
    >查看评论</div>


    </div>
    
        <div class="side">
				
        </div>
    
</div>


    </div>
</div>
</body>

<script src="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>


<script src="//lib.baomitu.com/jquery/1.8.3/jquery.min.js"></script>
<script src="/js/plugin.js"></script>
<script src="/js/typed.js"></script>
<script src="/js/diaspora.js"></script>


<link rel="stylesheet" href="/photoswipe/photoswipe.css">
<link rel="stylesheet" href="/photoswipe/default-skin/default-skin.css">


<script src="/photoswipe/photoswipe.min.js"></script>
<script src="/photoswipe/photoswipe-ui-default.min.js"></script>


<!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">
    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>
    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">
        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>
        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">
            <div class="pswp__top-bar">
                <!--  Controls are self-explanatory. Order can be changed. -->
                <div class="pswp__counter"></div>
                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
                <button class="pswp__button pswp__button--share" title="Share"></button>
                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                      <div class="pswp__preloader__cut">
                        <div class="pswp__preloader__donut"></div>
                      </div>
                    </div>
                </div>
            </div>
            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div> 
            </div>
            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>
            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>
            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>
        </div>
    </div>
</div>






</html>
